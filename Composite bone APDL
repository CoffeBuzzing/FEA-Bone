! =================================================!
! ANSYS APDL-scripts - Simple Bone
!     - Bone
!    -----------------------------------------
!       Geometry: [m]
!       Force:    [N]
!       Moment:   [Nm]
!       Pressure: [Pa]
! =================================================!

FINISH		 ! Make sure current ANSYS module is closed
/CLEAR,START ! Clear the ANSYS workspace 

! White background
/RGB,INDEX,100,100,100, 0   
/RGB,INDEX, 80, 80, 80,13   
/RGB,INDEX, 60, 60, 60,14   
/RGB,INDEX, 0, 0, 0,15  

!!!x = 127, y = -2841.6875

! =================================================!
! INPUT DATA - including material
! =================================================!

PI = 4*ATAN(1.0) ! Define variable PI as 3.1415...

! Remember to update title
*dim,TITLE_TEXT,string,20 ! Maximum 20 characters
/TITLE,%TITLE_TEXT(1)% Project 2

YOUNG_COMPACT = 19e3  ![N/mm^2]
YOUNG_SPONGY = 10e3   ![N/mm^2]
YOUNG_MARROW = 0.001e3 ![N/mm^2]
POISSON_COMPACT = 0.4         !E.g. steel: 0.3 [-]
POISSON_SPONGY = 0.2
POISSON_MARROW = 0.3
TIMO = 1000*YOUNG_COMPACT

WEIGHT = 400 ![N]

! =================================================!
! GEOMETRY DEFINITIONS - in preprocessor (/PREP7)
! =================================================!
/PREP7 ! Enter the preprocessor

!Keypoints
K,1,0,232.3125,0
K,2,-6.1733,-242.3125,0
K,3,1,233.3125,0
K,4,8,239.3125,0
K,5,12,241.3125,0
K,6,19,242.3125,0
K,7,22,242.3125,0
K,8,30,241.3125,0
K,9,35,240.3125,0
K,10,37,239.3125,0
K,11,42,235.3125,0
K,12,44,232.3125,0
K,13,45,229.3125,0
K,14,45,223.3125,0
K,15,46,218.3125,0
K,16,48,213.3125,0
K,17,52,209.3125,0
K,18,57,206.3125,0
K,19,59,205.3125,0
K,20,63,207.3125,0
K,21,67,209.3125,0
K,22,78,209.3125,0
K,23,83,206.3125,0
K,24,86,201.3125,0
K,25,88,193.3125,0
K,26,89,184.3125,0
K,27,89,179.3125,0
K,28,88,173.3125,0
K,29,87,169.3125,0
K,30,86,166.3125,0
K,31,84,166.3125,0
K,32,81,164.3125,0
K,33,78,160.3125,0
K,34,74,153.3125,0
K,35,66,134.3125,0
K,36,64,128.3125,0
K,37,62,122.3125,0
K,38,59,112.3125,0
K,39,57,106.3125,0
K,40,55,101.3125,0
K,41,52,94.3125,0
K,42,49,87.3125,0
K,43,47,81.3125,0
K,44,45,73.3125,0
K,45,43,67.3125,0
K,46,41,60.3125,0
K,47,39,54.3125,0
K,48,36,43.3125,0
K,49,35,39.3125,0
K,50,33,30.3125,0
K,51,32,25.3125,0
K,52,31,21.3125,0
K,53,27,6.3125,0
K,54,23.2353,-8.6875,0
K,55,19,-26.6875,0
K,56,16.4118,-37.6875,0
K,57,13,-58.6875,0
K,58,10,-83.6875,0
K,59,5,-111.6875,0
K,60,0,-142.6875,0
K,61,0,-172.6875,0
K,62,4,-189.6875,0
K,63,8,-197.6875,0
K,64,10,-206.6875,0
K,65,9,-216.6875,0
K,66,7,-228.6875,0
K,67,5,-235.6875,0
K,68,0,-240.6875,0
K,69,-13,-241.6875,0
K,70,-22,-238.6875,0
K,71,-29.8404,-234.6875,0
K,72,-34,-231.6875,0
K,73,-38,-229.6875,0
K,74,-40,-229.6875,0
K,75,-47,-232.6875,0
K,76,-54,-237.6875,0
K,77,-62,-239.6875,0
K,78,-73,-239.6875,0
K,79,-79,-236.6875,0
K,80,-82,-233.6875,0
K,81,-83,-228.6875,0
K,82,-86,-222.6875,0
K,83,-89,-214.6875,0
K,84,-86,-197.6875,0
K,85,-84,-190.6875,0
K,86,-78,-184.6875,0
K,87,-73,-180.6875,0
K,88,-67,-174.6875,0
K,89,-61,-165.6875,0
K,90,-51,-142.6875,0
K,91,-46,-126.6875,0
K,92,-41,-111.6875,0
K,93,-37,-96.6875,0
K,94,-35,-86.6875,0
K,95,-30,-68.6875,0
K,96,-23,-47.6875,0
K,97,-17.1176,-27.6875,0
K,98,-12,-7.6875,0
K,99,-9.1176,6.3125,0
K,100,-5.5882,21.3125,0
K,101,-3,32.3125,0
K,102,2,49.3125,0
K,103,5,62.3125,0
K,104,8,72.3125,0
K,105,11,84.3125,0
K,106,17,105.3125,0
K,107,20,115.3125,0
K,108,21,121.3125,0
K,109,22,126.3125,0
K,110,23,130.3125,0
K,111,23,133.3125,0
K,112,21,138.3125,0
K,113,20,143.3125,0
K,114,21,149.3125,0
K,115,24,152.3125,0
K,116,24,154.3125,0
K,117,23,162.3125,0
K,118,21,172.3125,0
K,119,20,176.3125,0
K,120,19,181.3125,0
K,121,16,189.3125,0
K,122,13,193.3125,0
K,123,10,196.3125,0
K,124,6,197.3125,0
K,125,4,198.3125,0
K,126,2,201.3125,0
K,127,0,204.3125,0
K,128,-2,206.3125,0
K,129,-3,208.3125,0
K,130,-4,214.3125,0
K,131,-4,218.3125,0
K,132,-3,225.3125,0

!Lines
L,1,3 
L,3,4
L,4,5
L,5,6
L,6,7
L,7,8
L,8,9
L,9,10
L,10,11
L,11,12
L,12,13
L,13,14
L,14,15
L,15,16
L,16,17
L,17,18
L,18,19
L,19,20
L,20,21
L,21,22
L,22,23
L,23,24
L,24,25
L,25,26
L,26,27
L,27,28
L,28,29
L,29,30
L,30,31
L,31,32
L,32,33
L,33,34
L,34,35
L,35,36
L,36,37
L,37,38
L,38,39
L,39,40
L,40,41
L,41,42
L,42,43
L,43,44
L,44,45
L,45,46
L,46,47
L,47,48
L,48,49
L,49,50
L,50,51
L,51,52
L,52,53
L,53,54
L,54,55
L,55,56
L,56,57
L,57,58
L,58,59
L,59,60
L,60,61
L,61,62
L,62,63
L,63,64
L,64,65
L,65,66
L,66,67
L,67,68
L,68,2
L,2,69
L,69,70
L,70,71
L,71,72
L,72,73
L,73,74
L,74,75
L,75,76
L,76,77
L,77,78
L,78,79
L,79,80
L,80,81
L,81,82
L,82,83
L,83,84
L,84,85
L,85,86
L,86,87
L,87,88
L,88,89
L,89,90
L,90,91
L,91,92
L,92,93
L,93,94
L,94,95
L,95,96
L,96,97
L,97,98
L,98,99
L,99,100
L,100,101
L,101,102
L,102,103
L,103,104
L,104,105
L,105,106
L,106,107
L,107,108
L,108,109
L,109,110
L,110,111
L,111,112
L,112,113
L,113,114
L,114,115
L,115,116
L,116,117
L,117,118
L,118,119
L,119,120
L,120,121
L,121,122
L,122,123
L,123,124
L,124,125
L,125,126
L,126,127
L,127,128
L,128,129
L,129,130
L,130,131
L,131,132
L,132,1

AL,all      ! Area from all lines

!Keypoints Spongy
K,133,30.66676,240.3085,0
K,134,-40.7687,-226.2455,0
K,135,-42.7687,-226.2455,0
K,136,-47.7687,-228.2455,0
K,137,-54.7687,-234.2455,0
K,138,-55.7687,-235.2455,0
K,139,-57.7687,-236.2455,0
K,140,-64.7687,-237.2455,0
K,141,-66.7687,-237.2455,0
K,142,-68.7687,-237.2455,0
K,143,-73.7687,-236.2455,0
K,144,-76.7687,-234.2455,0
K,145,-78.7687,-232.2455,0
K,146,-79.7687,-229.2455,0
K,147,-79.7687,-226.2455,0
K,148,-80.7687,-223.2455,0
K,149,-82.7687,-220.2455,0
K,150,-84.7687,-217.2455,0
K,151,-85.7687,-214.2455,0
K,152,-85.7687,-212.2455,0
K,153,-85.7687,-210.2455,0
K,154,-85.7687,-205.2455,0
K,155,-84.7687,-201.2455,0
K,156,-82.7687,-195.2455,0
K,157,-80.7687,-191.2455,0
K,158,-78.7687,-188.2455,0
K,159,-76.7687,-186.2455,0
K,160,-74.7687,-185.2455,0
K,161,-71.7687,-183.2455,0
K,162,-68.7687,-180.2455,0
K,163,-64.7687,-175.2455,0
K,164,-59.7687,-169.2455,0
K,165,-55.7687,-163.2455,0
K,166,-52.7687,-158.2455,0
K,167,-46.7687,-146.2455,0
K,168,-42.7687,-137.2455,0
K,169,-38.7687,-127.2455,0
K,170,-36.7687,-122.2455,0
K,171,-33.7687,-112.2455,0
K,172,-31.7687,-106.2455,0
K,173,-27.7687,-92.2455,0
K,174,-22.7687,-77.2455,0
K,175,-17.7687,-62.2455,0
K,176,-14.7687,-53.2455,0
K,177,-11.7687,-40.2455,0
K,178,-7.7687,-25.2455,0
K,179,-5.7687,-13.2455,0
K,180,-2.7687,-0.2455,0
K,181,2.2313,21.7545,0
K,182,6.2313,34.7545,0
K,183,8.2313,43.7545,0
K,184,12.2313,57.7545,0
K,185,16.2313,75.7545,0
K,186,21.2313,93.7545,0
K,187,26.2313,107.7545,0
K,188,29.23129,122.7545,0
K,189,30.23129,129.7545,0
K,190,31.23129,138.7545,0
K,191,32.23129,151.7545,0
K,192,33.23129,160.7545,0
K,193,31.23129,172.7545,0
K,194,28.23129,184.7545,0
K,195,22.2313,193.7545,0
K,196,19.2313,196.7545,0
K,197,16.2313,198.7545,0
K,198,13.2313,199.7545,0
K,199,11.2313,199.7545,0
K,200,8.2313,200.7545,0
K,201,6.2313,201.7545,0
K,202,3.2313,205.7545,0
K,203,1.2313,207.7545,0
K,204,0.2313,209.7545,0
K,205,-0.7687,211.7545,0
K,206,-0.7687,214.7545,0
K,207,-0.7687,217.7545,0
K,208,0.2313,224.7545,0
K,209,1.2313,227.7545,0
K,210,2.2313,230.7545,0
K,211,5.2313,231.7545,0
K,212,7.2313,233.7545,0
K,213,10.2313,236.7545,0
K,214,11.2313,238.7545,0
K,215,13.2313,240.7545,0
K,216,19.2313,241.7545,0
K,217,22.2313,241.7545,0
K,218,29.23129,240.7545,0
K,219,37.23129,236.7545,0
K,220,41.23129,232.7545,0
K,221,43.23129,229.7545,0
K,222,43.23129,225.7545,0
K,223,43.23129,220.7545,0
K,224,46.23129,211.7545,0
K,225,49.23129,207.7545,0
K,226,56.23129,201.7545,0
K,227,58.23129,200.7545,0
K,228,60.23129,202.7545,0
K,229,63.23129,204.7545,0
K,230,64.23129,205.7545,0
K,231,70.23129,207.7545,0
K,232,75.23129,207.7545,0
K,233,78.23129,206.7545,0
K,234,80.23129,204.7545,0
K,235,83.23129,199.7545,0
K,236,84.23129,193.7545,0
K,237,83.23129,182.7545,0
K,238,82.23129,174.7545,0
K,239,81.23129,170.7545,0
K,240,78.23129,167.7545,0
K,241,73.23129,160.7545,0
K,242,68.23129,152.7545,0
K,243,64.23129,145.7545,0
K,244,61.23129,140.7545,0
K,245,58.23129,136.7545,0
K,246,55.23129,128.7545,0
K,247,48.23129,113.7545,0
K,248,43.23129,99.7545,0
K,249,37.23129,77.7545,0
K,250,31.23129,59.7545,0
K,251,26.2313,41.7545,0
K,252,22.2313,22.7545,0
K,253,19.2313,9.7545,0
K,254,15.2313,-6.2455,0
K,255,11.2313,-24.2455,0
K,256,6.2313,-45.2455,0
K,257,4.2313,-58.2455,0
K,258,1.2313,-72.2455,0
K,259,0.2313,-82.2455,0
K,260,-2.7687,-102.2455,0
K,261,-3.7687,-114.2455,0
K,262,-3.7687,-141.2455,0
K,263,-3.7687,-152.2455,0
K,264,-3.7687,-170.2455,0
K,265,-1.7687,-183.2455,0
K,266,0.2313,-190.2455,0
K,267,2.2313,-196.2455,0
K,268,4.2313,-202.2455,0
K,269,6.2313,-206.2455,0
K,270,6.2313,-212.2455,0
K,271,5.2313,-216.2455,0
K,272,3.2313,-220.2455,0
K,273,3.2313,-225.2455,0
K,274,3.2313,-229.2455,0
K,275,2.2313,-233.2455,0
K,276,-1.7687,-236.2455,0
K,277,-7.7687,-237.2455,0
K,278,-14.7687,-236.2455,0
K,279,-20.7687,-234.2455,0
K,280,-25.7687,-231.2455,0
K,281,-29.7687,-229.2455,0
K,282,-33.7687,-227.2455,0
K,283,-36.7687,-226.2455,0


!Lines Spongy
L,134,135
L,135,136
L,136,137
L,137,138
L,138,139
L,139,140
L,140,141
L,141,142
L,142,143
L,143,144
L,144,145
L,145,146
L,146,147
L,147,148
L,148,149
L,149,150
L,150,151
L,151,152
L,152,153
L,153,154
L,154,155
L,155,156
L,156,157
L,157,158
L,158,159
L,159,160
L,160,161
L,161,162
L,162,163
L,163,164
L,164,165
L,165,166
L,166,167
L,167,168
L,168,169
L,169,170
L,170,171
L,171,172
L,172,173
L,173,174
L,174,175
L,175,176
L,176,177
L,177,178
L,178,179
L,179,180
L,180,181
L,181,182
L,182,183
L,183,184
L,184,185
L,185,186
L,186,187
L,187,188
L,188,189
L,189,190
L,190,191
L,191,192
L,192,193
L,193,194
L,194,195
L,195,196
L,196,197
L,197,198
L,198,199
L,199,200
L,200,201
L,201,202
L,202,203
L,203,204
L,204,205
L,205,206
L,206,207
L,207,208
L,208,209
L,209,210
L,210,211
L,211,212
L,212,213
L,213,214
L,214,215
L,215,216
L,216,217
L,217,218
L,218,133
L,133,219
L,219,220
L,220,221
L,221,222
L,222,223
L,223,224
L,224,225
L,225,226
L,226,227
L,227,228
L,228,229
L,229,230
L,230,231
L,231,232
L,232,233
L,233,234
L,234,235
L,235,236
L,236,237
L,237,238
L,238,239
L,239,240
L,240,241
L,241,242
L,242,243
L,243,244
L,244,245
L,245,246
L,246,247
L,247,248
L,248,249
L,249,250
L,250,251
L,251,252
L,252,253
L,253,254
L,254,255
L,255,256
L,256,257
L,257,258
L,258,259
L,259,260
L,260,261
L,261,262
L,262,263
L,263,264
L,264,265
L,265,266
L,266,267
L,267,268
L,268,269
L,269,270
L,270,271
L,271,272
L,272,273
L,273,274
L,274,275
L,275,276
L,276,277
L,277,278
L,278,279
L,279,280
L,280,281
L,281,282
L,282,283
L,283,134

!Area inside compact bone lines
!Area inside marrow lines
LSEL,S,LINE,,133,283
AL,all
LSEL,ALL

ASBA,1,2,,,KEEP

!MARROW
K,284,-19.7687,-126.2455,0
K,285,49.28779,161.6645,0
K,286,-22.7687,-123.2455,0
K,287,-24.7687,-120.2455,0
K,288,-24.7687,-117.2455,0
K,289,-24.7687,-113.2455,0
K,290,-23.7687,-108.2455,0
K,291,-21.7687,-95.2455,0
K,292,-19.7687,-84.2455,0
K,293,-14.7687,-69.2455,0
K,294,-8.7687,-46.2455,0
K,295,-5.7687,-32.2455,0
K,296,-1.7687,-12.2455,0
K,297,2.2313,1.7545,0
K,298,7.2313,20.7545,0
K,299,10.2313,34.7545,0
K,300,14.2313,46.7545,0
K,301,18.2313,58.7545,0
K,302,22.2313,73.7545,0
K,303,25.2313,89.7545,0
K,304,31.23129,102.7545,0
K,305,35.23129,114.7545,0
K,306,39.23129,127.7545,0
K,307,42.23129,138.7545,0
K,308,44.23129,142.7545,0
K,309,44.23129,146.7545,0
K,310,44.23129,151.7545,0
K,311,49.23129,161.7545,0
K,312,49.23129,155.7545,0
K,313,48.23129,148.7545,0
K,314,48.23129,143.7545,0
K,315,47.23129,137.7545,0
K,316,45.23129,133.7545,0
K,317,43.23129,123.7545,0
K,318,42.23129,113.7545,0
K,319,37.23129,99.7545,0
K,320,32.23129,89.7545,0
K,321,28.23129,82.7545,0
K,322,28.23129,77.7545,0
K,323,25.2313,69.7545,0
K,324,24.2313,65.7545,0
K,325,21.2313,56.7545,0
K,326,18.2313,43.7545,0
K,327,15.2313,26.7545,0
K,328,14.2313,14.7545,0
K,329,10.2313,-1.2455,0
K,330,5.2313,-19.2455,0
K,331,3.2313,-30.2455,0
K,332,1.2313,-37.2455,0
K,333,-3.7687,-55.2455,0
K,334,-4.7687,-69.2455,0
K,335,-4.7687,-81.2455,0
K,336,-7.7687,-96.2455,0
K,337,-9.7687,-106.2455,0
K,338,-9.7687,-115.2455,0
K,339,-12.7687,-122.2455,0

!MARROW LINES
L,284,286
L,286,287
L,287,288
L,288,289
L,289,290
L,290,291
L,291,292
L,292,293
L,293,294
L,294,295
L,295,296
L,296,297
L,297,298
L,298,299
L,299,300
L,300,301
L,301,302
L,302,303
L,303,304
L,304,305
L,305,306
L,306,307
L,307,308
L,308,309
L,309,310
L,310,311
L,311,285
L,285,312
L,312,313
L,313,314
L,314,315
L,315,316
L,316,317
L,317,318
L,318,319
L,319,320
L,320,321
L,321,322
L,322,323
L,323,324
L,324,325
L,325,326
L,326,327
L,327,328
L,328,329
L,329,330
L,330,331
L,331,332
L,332,333
L,333,334
L,334,335
L,335,336
L,336,337
L,337,338
L,338,339
L,339,284

!Area inside marrow lines
LSEL,S,LINE,,284,339
AL,all
LSEL,ALL

ASBA,2,1,,,KEEP

NUMCMP,AREA

! =================================================!
! MATERIAL DEFINITIONS
! =================================================! 

MP,EX,1,YOUNG_COMPACT
MP,PRXY,1,POISSON_COMPACT
MP,EX,2,YOUNG_SPONGY
MP,PRXY,2,POISSON_SPONGY
MP,EX,3,YOUNG_MARROW
MP,PRXY,3,POISSON_MARROW

! =================================================!
! ELEMENT DEFINITIONS AND MESHING
! =================================================!

!Compact
ET,1,PLANE183
MSHAPE,0,2D
TYPE,1
MAT,1
AESIZE,2,1
AMESH,2

!Spongy
ET,2,PLANE183
MSHAPE,0,2D
TYPE,2
MAT,2
AESIZE,3,2
AMESH,3

!Marrow
ET,3,PLANE183
MSHAPE,0,2D
TYPE,3
MAT,3
AESIZE,1,1
AMESH,1


! =================================================!
! DEFINE BOUNDARY CONDITIONS AND LOADS
! =================================================! 

!Kneejoint and hip joint boundary
DK,73,,,,,,UX,UY
DK,6,,,,,,UX

!Bodyweight
LSEL,S,LINE,,1,10
NSLL,S,1
*GET,tnum,NODE,0,COUNT,,,
F,ALL,FY,-WEIGHT/tnum
NSEL,ALL


FINISH	! Exit the preprocessor

! =================================================!
! SOLUTION - in solution (/SOL)
! =================================================!

/SOL	! Enter the solution module

SOLVE	! Obtain solution

FINISH	! Exit the solution module


! =================================================!
! STUDY RESULTS - in postprocessor (/POST1) 
! =================================================!
/POST1
SET,FIRST
PLDISP,2


FINISH
